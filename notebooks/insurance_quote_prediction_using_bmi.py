# -*- coding: utf-8 -*-
"""Insurance Quote Prediction using BMI.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1KeLMT0cY2aO0_IndangBvzks3xHIedzv
"""

# Import the libraries

import pandas as pd
import numpy as np
import joblib
import matplotlib.pyplot as plt

# ML libraries
from sklearn.model_selection import train_test_split
from sklearn.linear_model import LinearRegression
from sklearn.ensemble import RandomForestClassifier

# metrics
from sklearn import metrics
from sklearn.metrics import r2_score

# Import the dataset
data = pd.read_csv('data/quote.csv')

data.head()

data.info()

y=data.quote
X=data.drop(['quote'],axis=1)

# Splitting the dataset into the Training set and Test set
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size = 0.2, random_state = 0)

model = RandomForestClassifier(n_estimators = 100, random_state = 0, criterion='entropy', max_depth=3, max_features=5)
model.fit(X_train, y_train)

# Predicting the Test set results
y_pred = model.predict(X_test)

model.score(X_test,y_test)

# Predicting the sigle observation results.
test_applicant = [38,1,83.91,1.5494,34.96]
df = pd.DataFrame([test_applicant], columns=['Ins_Age','Ins_Gender','Wt','meters','BMI'])
y_pred_single_obs = model.predict(df)
y_pred_single_obs[0]

#Saving the model
joblib.dump(model, "insurance_quote_model.pkl")

# testing the model through the pickle file
test_applicant = [38,1,83.91,1.5494,34.96]
df = pd.DataFrame([test_applicant], columns=['Ins_Age','Ins_Gender','Wt','meters','BMI'])
ins_quote = open("insurance_quote_model.pkl","rb")
ml_model = joblib.load(ins_quote)
model_prediction = ml_model.predict(df)

model_prediction[0]

